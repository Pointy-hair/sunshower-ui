apply plugin: 'ear'

publishing {
    publications {
        mavenJava(MavenPublication) {
            artifact ear
        }

    }
}

configurations {
    site
}



dependencies {
    earlib project(":search:search-es")
    earlib project(":hfs:hfs-service")
    earlib project(":service:service-vault")
    earlib project(":service:service-hal")
    earlib project(":service:service-security")
    deploy project(path: ':web:web-site', configuration: 'archives')
    deploy project(path: ':web:web-service', configuration:'archives')
}


ear {
    rename { deployment ->
        return stripVersion(deployment)
    }
}


String stripVersion(String input) {
    if(input.endsWith(".xml") || input.endsWith(".MF")) {
        return input
    }
    int fstIndexOf = input.indexOf('-');
    int lastIndexOf = input.lastIndexOf('.');
    if(fstIndexOf > -1 && lastIndexOf > -1) {
        final String extension = input.substring(lastIndexOf, input.length());
        final String fileName = input.substring(0, input.indexOf('-', fstIndexOf + 1));
        return fileName + extension;
    } else {
        return input;
    }
}
