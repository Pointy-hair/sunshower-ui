apply plugin: 'ear'

publishing {
    publications {
        mavenJava(MavenPublication) {
            artifact ear
        }

    }
}

configurations {
    site
}



dependencies {
    earlib project(":service:security")
//    site  project(path:':web:site')
//    deploy project(path: ':web:site', configuration: 'archives')
    deploy project(path:':web:service', configuration:'archives')
}

jar {
    manifest {
        attributes("FRAP": "DAP")
    }
}

ear {
    rename { deployment ->
        return stripVersion(deployment)
    }
}


String stripVersion(String input) {
    if(input.endsWith(".xml") || input.endsWith(".MF")) {
        return input
    }
    int fstIndexOf = input.indexOf('-');
    int lastIndexOf = input.lastIndexOf('.');
    if(fstIndexOf > -1 && lastIndexOf > -1) {
        final String extension = input.substring(lastIndexOf, input.length());
        final String fileName = input.substring(0, fstIndexOf);
        return fileName + extension;
    } else {
        return input;
    }
}
